"use strict";jQuery(document).ready(function(){function a(b,c,d,e){y.send(b,{onSuccess:function(i){i.data.forEach(function(a){if(a.kordinat_center){var b=parseFloat(a.kordinat_center.lat),e=parseFloat(a.kordinat_center.lng);c.push([b,e,a.id_lot]),g[0]+=b,g[1]+=e}d[a.id_lot]=a});var k=c.length/i.totalCount*100,o=Math.ceil(i.totalCount/l);if(console.log(k.toFixed(2)+" percent "),2>e){var q=_.map(g,function(a){return a/c.length});window.map=new L.Map("trees-id-map",{center:q,zoom:n,layers:[x]}),window.heat=L.heatLayer(c,p).addTo(window.map)}else window.heat.setLatLngs(c);o>1&&o>e?(e++,b=-1===b.indexOf("&page=")?b+"&page="+e:b.replace(/&page=?\d+$/g,"&page="+e),a(b,c,d,e)):window.map.on("zoomend dragend",function(){var a=window.map.getZoom();if(a>=m){var b=window.map.getBounds(),d=b.getWest(),e=b.getSouth(),g=b.getEast(),i=b.getNorth(),k=_.filter(c,function(a){return a[1]>d-.005&&a[1]<g+.005&&a[0]<i+.005&&a[0]>e-.005});k.length>0&&k.forEach(function(a){if(-1===h.indexOf(a)){h.push(a);var b="test content",b='<a class="popup-link text-center" href="#"><img id="popup-image" class="popup-image" src="'+f[a[2]].img_lot+'"></div><br> <span>'+f[a[2]].nama_lot+"</span></a>";j[a[2]]=L.polygon(f[a[2]].kordinat,{color:s,weight:t,fillColor:u,fillOpacity:v}).bindPopup(b),j[a[2]].addTo(window.map)}});var l=_.difference(h,k);l.forEach(function(a){var b=h.indexOf(a);h.splice(b,1),window.map.removeLayer(j[a[2]])}),window.map.removeLayer(window.heat)}else window.heat.addTo(window.map),j.forEach(function(a){window.map.removeLayer(a)}),h=[]})}})}function b(a){var b="http://api.trees.id/?object=lot&callback=callback&content=map&id="+a;y.send(b,{onSuccess:function(b){if(void 0!==b.data)window.map=new L.Map("trees-id-map",{center:b.mapCenter,zoom:m,layers:[x]}),window.heat=L.heatLayer(b.data,p).addTo(window.map),window.map.on("zoomend dragend",function(){var c=window.map.getZoom();if(c>=o){var d=window.map.getBounds(),e=d.getWest(),f=d.getSouth(),g=d.getEast(),h=d.getNorth(),j=_.filter(b.data,function(a){return a[1]>e-5e-5&&a[1]<g+5e-5&&a[0]<h+5e-5&&a[0]>f-5e-5});j.length>0&&j.forEach(function(c){if(-1===i.indexOf(c)){i.push(c);var d='<img src="'+q+b.id_relawan+"/"+a+"/"+c[2]+'" width="200">';k[c[2]]=L.marker([c[0],c[1]],{icon:w}).addTo(window.map).bindPopup(d)}});var l=_.difference(i,j);l.forEach(function(a){var b=i.indexOf(a);i.splice(b,1),window.map.removeLayer(k[a[2]])}),window.map.removeLayer(window.heat)}else window.heat.addTo(window.map),i.forEach(function(a){window.map.removeLayer(k[a[2]])}),i=[]});else{var c=[];b.polygon.forEach(function(a){var b=L.latLng(a[0],a[1]);c.push(b)}),window.map=new L.Map("trees-id-map",{center:b.center,zoom:m,layers:[x]}),window.lotPolygon=L.polygon(c,{color:s,weight:t,fillColor:u,fillOpacity:v}),window.lotPolygon.addTo(window.map)}},onTimeout:function(){console.log("timeout!")}})}function c(a){console.log("Rendering Single Tree ",a);var b="http://api.trees.id/?object=tree&callback=callback&single_id="+a;y.send(b,{onSuccess:function(a){console.log(a),window.map=new L.Map("trees-id-map",{center:a.data[0].tree_kordinat,zoom:o,layers:[x]});{var b='<img src="'+a.data[0].img_tree+'" width="200">';L.marker(a.data[0].tree_kordinat,{icon:w}).addTo(window.map).bindPopup(b).openPopup()}},onTimeout:function(){console.log("timeout!")}})}function d(){var d;if(d=z.getAttribute("data-map-type"),"tree"==d){var g=z.getAttribute("data-id");console.log("treeID",g),c(g)}else{var h=z.getAttribute("data-id");if(h)b(h);else{var i="http://api.trees.id/?object=lot&per_page="+l+"&callback=callback",j=[];r.forEach(function(a){var b=z.getAttribute("data-"+a);b&&(j[a]=b,i=i+"&"+a+"="+b)}),a(i,e,f,1)}}}var e=[],f=[],g=[0,0],h=[],i=[],j=[],k=[],l=20,m=17,n=7,o=22,p={radius:10,blur:10,maxZoom:11,gradient:{.4:"lime",.65:"green",1:"darkgreen"}},q="http://api.trees.id/tree/",r=["program_id","project_id","block_id","relawan_id","verifikator_id","petani_id","status"],s="lime",t=2,u="darkgreen",v=.5,w=L.icon({iconUrl:"http://api.trees.id/tree.png",iconSize:[16,16],iconAnchor:[0,8],popupAnchor:[8,-8]}),x=L.tileLayer("http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community",maxZoom:27,maxNativeZoom:17}),y=function(){var a={};return a.send=function(a,b){var c=b.callbackName||"callback",d=b.onSuccess||function(){},e=b.onTimeout||function(){},f=b.timeout||10,g=window.setTimeout(function(){window[c]=function(){},e()},1e3*f);window[c]=function(a){window.clearTimeout(g),d(a)};var h=document.createElement("script");h.type="text/javascript",h.async=!0,h.src=a,document.getElementsByTagName("head")[0].appendChild(h)},a}(),z=document.getElementById("trees-id-map");z&&d()});